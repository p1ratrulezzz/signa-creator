<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="152x152" href="images/phone-favicon.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    <title>Signa</title>
    <style type="text/css">
        /*#signa-wrapper {*/
            /*width: 100%;*/
            /*height: 100%;*/
        /*}*/

        .clearfix {
            clear: both;
        }
    </style>
</head>
<body>
<div id="signa-wrapper">
    <img id="signa" src="">
    <div id="text-layer1" class="text-layer text-layer1">Виктор</div>
    <div id="text-layer2" class="text-layer text-layer2">Громыко</div>
</div>
<div class="clearfix"></div>
Введи свой текст:
<div class="input-wrapper">
    Имя: <input id="texter-text-layer1" class="text-writer" type="text">
    Фамилия: <input id="texter-text-layer2" class="text-writer" type="text">
</div>
<input id="downloader" type="button" value="Download as jpg" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript">
    (function($) {
        function base_url() {
            let arr = window.location.pathname.split('/');
            arr.pop();
            return arr.join('/');
        }

        let script = $('<script>').attr('src', base_url() + '/bower_components/dom-to-image/dist/dom-to-image.min.js');
        $('head').append(script);

        let linkCSS = $('<link rel="stylesheet">').attr('href', base_url() + '/nustya/main.css');
        $('head').append(linkCSS);

        let imagePath = base_url() + '/nustya/main_template.png';
        //let imagePath = base_url() + '/nustya/main.jpg';
        let fontPath = base_url() + '/fonts/Annabelle.ttf';

        $('#signa').attr('src', imagePath);
        $('head').append('<style type="text/css">@font-face { font-family:"Custom"; src: url("' + fontPath + '") format("truetype"); }</style>');

        $(function() {
            $('#downloader').bind('click', function(e) {
                let node = document.getElementById('signa-wrapper');
                domtoimage.toJpeg(node, {
                    quality: 1,
                    width: $('#signa').width(),
                    height: $('#signa').height(),
                    bgcolor: '#FF'
                }).then(function (dataUrl) {
                    let link = document.createElement('a');
                    let d = new Date();
                    link.download = 'signa_' + d.getFullYear() + d.getMonth() + d.getDate() + '_' + (d.getTime() % (24 * 1000)) + '.jpg';
                    link.href = dataUrl;
                    link.click();
                });
            });

            $('.text-writer').bind('keyup', function(e) {
                let $this = $(this);
                let ids = $this.attr('id').split('-');
                ids.shift();
                ids = ids.join('-');
                let $textLayerBlock = $('#' + ids);
                let text = $this.val();
                $textLayerBlock.html(text);
            });
        });
    }) (jQuery)
</script>
</body>
</html>
